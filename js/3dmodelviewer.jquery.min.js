/*!
 * 3D model viewer plugin for jQuery utlising Three.js
 * @require jQuery
 * @require Three.js
 * @author John Noel <john.noel@rckt.co.uk>
 * @license http://creativecommons.org/licenses/by-sa/3.0/ Creative Commons Attribution Share-Alike
 */
(function($){var methods={init:function(options){var opts=$.extend(true,{},$.fn.threeDeeModelViewer.options,options);return this.each(function(){var $this=$(this),data=$this.data("3dmv");if(!data){data={};data.model=opts.model;data.renderer=new THREE.WebGLRenderer({antialias:true,clearColor:opts.backgroundColour,clearAlpha:opts.backgroundAlpha,stencil:false});data.renderer.setSize($this.width(),$this.height());$this.append(data.renderer.domElement);data.scene=new THREE.Scene();data.camera=new THREE.PerspectiveCamera(70,$this.width()/$this.height(),1,100000);data.camera.position=opts.cameraPosition;data.scene.add(data.camera);data.opts=opts;$this.trigger("3dmv.playerloaded").data("3dmv",data);if(data.model.mesh!=""){$this.threeDeeModelViewer("loadModel",data.model.mesh,data.model.texture)}if(opts.autorotate){$this.threeDeeModelViewer("autorotate",0)}}$this.threeDeeModelViewer("animate")})},loadModel:function(model,texture){return this.each(function(){var $this=$(this),data=$this.data("3dmv");if(data.mesh){data.scene.remove(data.mesh)}var callback=function(geometry){data.texture=THREE.ImageUtils.loadTexture(texture,THREE.UVMapping);if(texture){data.material=new THREE.MeshBasicMaterial({color:16777215,map:data.texture,wireframe:false})}else{var dl=new THREE.DirectionalLight(16777215,0.75);dl.position.set(1,1,2).normalize();data.scene.add(dl);data.material=new THREE.MeshLambertMaterial({color:16777215,shading:THREE.FlatShading})}data.mesh=new THREE.Mesh(geometry,data.material);data.scene.add(data.mesh);$this.trigger("3dmv.sceneloaded").data("3dmv",data)};if(typeof model=="object"){new THREE.JSONLoader().createModel(model,callback)}else{new THREE.JSONLoader().load(model,callback)}})},toggleFullscreen:function(fullscreen){return this.each(function(){var $this=$(this),data=$this.data("3dmv");if(fullscreen){data.renderer.setSize($(window).width(),$(window).height());data.camera.aspect=$(window).width()/$(window).height();data.camera.updateProjectionMatrix()}else{data.renderer.setSize($this.width(),$this.height());data.camera.aspect=$this.width()/$this.height();data.camera.updateProjectionMatrix()}})},translate:function(direction,amount){return this.each(function(){var $this=$(this),data=$this.data("3dmv");if(!data||!data.mesh){return}if((typeof(amount)=="string")&&($.inArray(amount.substr(0,1),["+","-","*","/"])!=-1)&&amount.substr(1,1)=="="){var ec="";var am=parseFloat(amount.substr(2));switch(direction){case $.fn.threeDeeModelViewer.LEFT:ec="data.mesh.rotation.y";am*=-1;break;case $.fn.threeDeeModelViewer.RIGHT:ec="data.mesh.rotation.y";break;case $.fn.threeDeeModelViewer.UP:ec="data.mesh.rotation.x";am*=-1;break;case $.fn.threeDeeModelViewer.DOWN:ec="data.mesh.rotation.x";break;case $.fn.threeDeeModelViewer.IN:ec="data.camera.position.z";am*=-1;break;case $.fn.threeDeeModelViewer.OUT:ec="data.camera.position.z";break}ec+=amount.substr(0,2);ec+=am;eval(ec)}else{switch(direction){case $.fn.threeDeeModelViewer.LEFT:data.mesh.rotation.y=(amount*-1);break;case $.fn.threeDeeModelViewer.RIGHT:data.mesh.rotation.y=amount;break;case $.fn.threeDeeModelViewer.UP:data.mesh.rotation.x=(amount*-1);break;case $.fn.threeDeeModelViewer.DOWN:data.mesh.rotation.x=amount;break;case $.fn.threeDeeModelViewer.IN:data.camera.position.z=(amount*-1);break;case $.fn.threeDeeModelViewer.OUT:data.camera.position.z=amount;break}}})},rotationX:function(){var $this=this.first(),data=$this.data("3dmv");return data.mesh.rotation.x},rotationY:function(){var $this=this.first(),data=$this.data("3dmv");return data.mesh.rotation.y},getScene:function(){var $this=this.first(),data=$this.data("3dmv");return data.scene},animate:function(){return this.each(function(){var $this=$(this),data=$this.data("3dmv");if(data){window.requestAnimationFrame(function(){$this.threeDeeModelViewer("animate")});$(this).threeDeeModelViewer("render")}})},render:function(){return this.each(function(){var data=$(this).data("3dmv");if(data){data.renderer.render(data.scene,data.camera)}})},reset:function(){return this.each(function(){var $this=$(this),data=$this.data("3dmv");$this.threeDeeModelViewer("translate",$.fn.threeDeeModelViewer.UP,0).threeDeeModelViewer("translate",$.fn.threeDeeModelViewer.LEFT,0).threeDeeModelViewer("translate",$.fn.threeDeeModelViewer.OUT,data.opts.cameraPosition.z)})},autorotate:function(delay,fullstop){var delay=(delay==undefined)?1500:delay;return this.each(function(){var $this=$(this),data=$this.data("3dmv");if(!data.opts.autorotate){return}if(data.autorotateDelay||data.autorotateTimer){clearTimeout(data.autorotateDelay);clearInterval(data.autorotateTimer);if(fullstop){return}}data.autorotateDelay=setTimeout(function(){data.autorotateTimer=setInterval(function(){$this.threeDeeModelViewer("translate",$.fn.threeDeeModelViewer.LEFT,"+="+0.015)},33)},delay);$this.data("3dmv",data)})}};$.fn.threeDeeModelViewer=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method=="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method: "+method+" not supported")}}};$.fn.threeDeeModelViewer.options={model:{mesh:"",texture:""},backgroundColour:16777215,backgroundAlpha:1,cameraPosition:{x:0,y:-0.5,z:8},autorotate:false};$.fn.threeDeeModelViewer.LEFT=1;$.fn.threeDeeModelViewer.RIGHT=2;$.fn.threeDeeModelViewer.UP=3;$.fn.threeDeeModelViewer.DOWN=4;$.fn.threeDeeModelViewer.IN=5;$.fn.threeDeeModelViewer.OUT=6})(jQuery);
/*!
 * Provides requestAnimationFrame in a cross browser way.
 * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
 */
if(!window.requestAnimationFrame){window.requestAnimationFrame=(function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b,a){window.setTimeout(b,1000/60)}})()};